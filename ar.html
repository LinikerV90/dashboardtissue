<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Teste Gauge</title>

  <!-- A-Frame + MindAR -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <!-- Gauges -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>

  <style>
    body { margin:0; overflow:hidden; background:#000; }
    canvas { visibility:hidden; position:absolute; left:-9999px; }
  </style>
</head>
<body>

<a-scene
  mindar-image="imageTargetSrc: asset/targets.mind;"
  color-space="sRGB"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: true"
>
  <a-assets>
    <!-- canvas registrado como asset -->
    <canvas id="gTorque" width="512" height="512"></canvas>
  </a-assets>

  <a-camera position="0 0 0"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" id="anchor">
    <a-text value="Teste Gauge" position="0 1 0" align="center" color="#00AEEF" width="2"></a-text>
    <a-plane id="planeTorque" position="0 0 0.01" width="1.2" height="1.2"></a-plane>
  </a-entity>
</a-scene>

<script>
(async function(){
  // cria o gauge
  const torqueGauge = new RadialGauge({
    renderTo: 'gTorque',
    width: 512,
    height: 512,
    units: 'Torque (Nm)',
    minValue: 0,
    maxValue: 100,
    majorTicks: ['0','20','40','60','80','100'],
    minorTicks: 4,
    borders: true,
    value: 50,
    highlights: [
      {from:0,to:60,color:'#30B32D'},
      {from:60,to:85,color:'#FFDD00'},
      {from:85,to:100,color:'#F03E3E'}
    ]
  }).draw();

  const anchor = document.getElementById('anchor');
  const plane = document.getElementById('planeTorque');

  anchor.addEventListener("targetFound", () => {
    console.log("Imagem detectada! Mostrando gauge.");
    plane.setAttribute('material', `src: #gTorque; transparent: true;`);
    plane.setAttribute('visible', 'true');
    plane.setAttribute('rotation','0 0 0');
    const mesh = plane.getObject3D('mesh');
    if (mesh && mesh.material.map) {
      mesh.material.map.needsUpdate = true;
    }
  });

  anchor.addEventListener("targetLost", () => {
    console.log("Imagem perdida. Escondendo gauge.");
    plane.setAttribute('visible','false');
  });
})();
</script>

</body>
</html>
